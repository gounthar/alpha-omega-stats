name: Test PR Collector

on:
  schedule:
    - cron: '18 07 * * 2'  # Run every Tuesday at 07:18 UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  test-pr-collector:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build Docker image
        run: docker build -t jenkins-pr-collector .

      - name: Run PR collector
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          docker run \
            -e GITHUB_TOKEN=$GITHUB_TOKEN \
            -v ${{ github.workspace }}/report.json:/app/report.json \
            jenkins-pr-collector

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: 'Update PR statistics report'
          title: 'Update PR statistics report'
          body: |
            This PR updates the PR statistics report using the jenkins-pr-collector.
            
            - Generated automatically by the PR Collector Test workflow
            - Data collection period: From August 2024 to current date
          branch: update-pr-stats
          delete-branch: true
          base: main 